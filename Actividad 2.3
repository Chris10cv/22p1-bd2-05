/*
1.- PROCEDIMIENTO 
*/
drop procedure IF EXISTS bd_sample.sp_guardar_subscriptor;

DELIMITER //
create procedure bd_sample.sp_guardar_subscriptor (
	in p_id_subscriptor     			int,
    	in p_codigo_subscriptor 			int,
    	in p_nombres				varchar (25),
    	in p_apellidos 				varchar (25)
)
BEGIN 
	declare  v_id_subscriptor 		int;
	declare  v_codigo_subscriptor 		int;
	declare  v_nombres 			varchar (25);
	declare  v_apellidos 			varchar (25);
    
    	set v_id_subscriptor			= p_id_subscriptor;
    	set v_codigo_subscriptor		= p_codigo_subscriptor;
    	set v_nombres				= p_nombres;
    	set v_apellidos				= p_apellidos;

	IF v_codigo_subscriptor is null then
			insert into bd_sample.tbl_subscriptores (
				id_subscriptor, codigo_subscriptor, nombres, apellidos
			) values (
				v_id_subscriptor, v_codigo_subscriptor, v_nombres, v_apellidos 
			);
	else 
			update bd_sample.tbl_subscriptores 
            set nombres 		= v_nombres
						apellidos 		= v_apellidos
            where codigo_subscriptor = v_codigo_subscriptor;    
		end if;

	commit;
END;

CALL bd_sample.sp_guardar_subscriptor( 
	0, 				# p_id_subscriptor
     	202211119, 				# p_codigo_subscriptor 
    	'ANDRES LUJAN',				# p_nombres 
    	'INIESTA'				# p_apellidos
);

select * 
from bd_sample.tbl_subscriptores
where codigo_subscriptor = 202211119 ;



-----------------------------------------------------------------------------------
/*
Procedimiento 2
*/

drop procedure IF EXISTS bd_sample.sp_guardar_producto;

DELIMITER $$ 
create procedure bd_sample.sp_guardar_producto (
    in p_id_producto     	int,
    in p_nombre 		varchar (25),
    in p_descripcion 		varchar (25),
    in p_precio_costo 		decimal (12,2),
    in p_precio_venta 		decimal (12,2),
    in p_porcentaje			varchar (25)
)
BEGIN 

	declare  v_id_producto 		int;
	declare  v_nombre		varchar (25);
	declare  v_descripcion 		varchar (25);
	declare  v_precio_costo 	decimal (12,2);
   	declare  v_precio_venta 	decimal (12,2);
    declare  v_porcentaje		varchar (25);
    
    
    set v_id_producto       = p_id_producto;
    set v_nombre			= p_nombre;
    set  v_descripcion		= p_descripcion;
    set  v_precio_costo		= p_precio_costo;    
    set v_precio_venta 		= p_precio_venta * 1.25;
    set v_porcentaje		= p_porcentaje;
    
    select precio_venta into v_precio_venta
    from bd_sample.tbl_productos
    where precio_venta = v_precio_venta ;
    
    
   case 
		when v_precio_venta between  0 and  3.99  	then set v_porcentaje = 	p_porcentaje * 0.30 ;
		when v_precio_venta between  4 and  7.99  then 	set v_porcentaje =	p_porcentaje * 0.50 ;
		when v_precio_venta >= 8 then				set v_porcentaje = 	p_porcentaje * 0.60 ;
		else set v_porcentaje = 'otro ' ;
    end case;
    
    
	insert into bd_sample.tbl_productos (
	id_producto, nombre, descripcion, precio_costo, precio_venta, porcentaje
	) values (
	v_id_producto, v_nombre, v_descripcion, v_precio_costo, v_precio_venta, v_porcentaje
	);

	commit;
END;


select * from bd_sample.tbl_productos

CALL bd_sample.sp_guardar_producto (
0,		 		# p_id_producto
'Plan Diamond',			# p_nombre 
'Plan VIP', 			# p_descripcion 	
20,				# p_precio_costo
20, 				# p_precio_venta
					#p_porcentaje
);

 
